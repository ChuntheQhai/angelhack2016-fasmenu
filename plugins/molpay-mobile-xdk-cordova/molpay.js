function MOLPay(){window.open=cordova.InAppBrowser.open}Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var a=this.length-1;a>=0;a--)this[a]&&this[a].parentElement&&this[a].parentElement.removeChild(this[a])};var isInternalDebugging=!1,moduleId="molpay-mobile-xdk-cordova",wrapperVersion="0",molpaySdkUrl="molpay-mobile-xdk-www/index.html",mpopenmolpaywindow="mpopenmolpaywindow://",mptransactionresults="mptransactionresults://",mprunscriptonpopup="mprunscriptonpopup://",molpayresulturl="https://www.onlinepayment.com.my/MOLPay/result.php",molpaynbepayurl="https://www.onlinepayment.com.my/MOLPay/nbepay.php",b4results='"msgType":"B4"',c6results='"msgType":"C6"',molpayPaymentDetails,transactionResultCallback,molpayDiv,mainUiFrame,bankUiWindow,molpayTransactionRequestFrame,isClosingMolpay=!1,hideFrame=function(a){a.style.visibility="hidden",a.style.position="absolute",a.style.width="0px",a.style.height="0px"},showFrame=function(a){a.style.visibility="visible",a.style.position="absolute",a.style.width="100%",a.style.height="100%"},postMolpayResultHandler=function(a){isInternalDebugging&&console.log("postMolpayResultHandler innHtml = "+a);var b=a;if(b){var c=new RegExp("<iframe"),d=c.exec(b);d&&(b=b.slice(0,d.index));var e=function(a){var b,c,d=a,e=new RegExp("<","g"),f=new RegExp("<"),g=new RegExp(">"),h=d.match(e);if(d&&h&&f.exec(d)&&g.exec(d))for(var i=h.length-1;i>=0;i--)b=f.exec(d).index,c=g.exec(d).index,d=d.substring(0,b)+""+d.substring(c+1);return d};b=e(b),isInternalDebugging&&console.log("innHtmlString = "+b);var f,g;if(f=new RegExp(b4results),f.test(b)&&(isInternalDebugging&&console.log("onMolpayUiFrameLoad B4 results = "+b),g=JSON.parse(b))){var h=g.tranID;h&&(isInternalDebugging&&console.log("mainUiFrame.contentWindow.transactionRequestWithTransactionId = "+h),mainUiFrame.contentWindow.transactionRequestWithTransactionId(h))}}},createBankUiWindow=function(a){var b="data:text/html;base64,"+a;bankUiWindow=window.open(b,"_blank","location=no,hardwareback=no,disallowoverscroll=yes,toolbarposition=top,transitionstyle=crossdissolve");var c=function(a){mainUiFrame.contentWindow.transactionRequest(),bankUiWindow.removeEventListener("exit",c)};bankUiWindow.addEventListener("exit",c);var d=function(a){isInternalDebugging&&console.log("onBankUiLoadstop event.url ="+a.url);var b;b=new RegExp(molpayresulturl),a&&b.test(a.url)&&(isInternalDebugging&&console.log("onBankUiLoadstop molpayresulturl found"),bankUiWindow.executeScript({code:"document.body.innerHTML"},function(a){var b=a[0];postMolpayResultHandler(b),bankUiWindow.removeEventListener("loadstop",d),bankUiWindow.close()})),b=new RegExp(molpaynbepayurl),a&&b.test(a.url)&&(isInternalDebugging&&console.log("onBankUiLoadstop molpaynbepayurl found"),bankUiWindow.executeScript({code:"window.open = function (open) {        return function (url, name, features) {          window.location = url ;          return window;         };         } (window.open);"},function(a){isInternalDebugging&&console.log("bankUiWindow window.open to window.location inject ok")}),bankUiWindow.executeScript({code:"window.close = function () {        window.location.assign(window.location);        };"},function(a){isInternalDebugging&&console.log("bankUiWindow window.close to window.location.assign inject ok")}))};bankUiWindow.addEventListener("loadstop",d);var e=function(a){isInternalDebugging&&console.log("onBankUiLoadstart event.url = "+a.url);var b;if(b=new RegExp(molpayresulturl),a&&b.test(a.url)&&(isInternalDebugging&&console.log("onBankUiLoadstart molpayresulturl found"),bankUiWindow.executeScript({code:"document.body.innerHTML"},function(a){var b=a[0];isInternalDebugging&&console.log("bankUiWindow document.body.innerHTML retrieved = "+b),postMolpayResultHandler(b),bankUiWindow.removeEventListener("loadstop",d),bankUiWindow.close()})),b=new RegExp(molpaynbepayurl),a&&b.test(a.url)){isInternalDebugging&&console.log("onBankUiLoadstart molpaynbepayurl found");var c=10,f=0,g=setInterval(function(){h()},1e3),h=function(){f++,f>c?clearInterval(g):bankUiWindow.executeScript({code:"document.body.innerHTML"},function(a){var b=a[0];isInternalDebugging&&console.log("bankUiWindow document.body.innerHTML retrieved = "+b);var c=new RegExp(b4results);c.test(b)&&(postMolpayResultHandler(b),bankUiWindow.removeEventListener("loadstart",e),bankUiWindow.close(),clearInterval(g))})}}};bankUiWindow.addEventListener("loadstart",e)},inAppCallback=function(a){var b,c;if(a&&a.indexOf(mpopenmolpaywindow)>-1)c=new RegExp(mpopenmolpaywindow,"g"),b=a.replace(c,""),b&&b.length>0&&(isInternalDebugging&&console.log("inAppCallback base64HtmlString = ",b),createBankUiWindow(b));else if(a&&a.indexOf(mptransactionresults)>-1&&(c=new RegExp(mptransactionresults,"g"),b=a.replace(c,""),b&&b.length>0)){var d=window.atob(b),e=JSON.stringify(JSON.parse(d));transactionResultCallback(e),isClosingMolpay&&(molpayDiv.innerHTML="",isClosingMolpay=!1),molpayTransactionRequestFrame&&molpayTransactionRequestFrame.remove()}if(a&&a.indexOf(mprunscriptonpopup)>-1&&(c=new RegExp(mprunscriptonpopup,"g"),b=a.replace(c,""),b&&b.length>0)){var f=window.atob(b);isInternalDebugging&&console.log("run script on popup, script ="+f),bankUiWindow.executeScript({code:f},function(a){isInternalDebugging&&console.log("run script on popup ok")})}},exec=require("cordova/exec");MOLPay.prototype.startMolpay=function(a,b){isInternalDebugging&&console.log("MOLPay startmolpay paymentdetails = "+JSON.stringify(a,null,"")),isClosingMolpay=!1;try{molpayPaymentDetails=JSON.parse(a)}catch(c){molpayPaymentDetails=a}molpayPaymentDetails.module_id=moduleId,molpayPaymentDetails.wrapper_version=wrapperVersion,transactionResultCallback=b,molpayDiv=document.getElementById("molpay"),molpayDiv.style.width="100%",molpayDiv.style.padding="0px",molpayDiv.style.border="0px",mainUiFrame=document.createElement("iframe");var d=function(a){mainUiFrame.contentWindow.updateSdkData(molpayPaymentDetails,inAppCallback),mainUiFrame.removeEventListener("load",d)};mainUiFrame.style.border="0px",mainUiFrame.style.padding="0px",mainUiFrame.style.width="100%",mainUiFrame.style.height="100%",mainUiFrame.id="mainUiFrame",mainUiFrame.allowScriptAccess="always",mainUiFrame.setAttribute("src",molpaySdkUrl),molpayDiv.appendChild(mainUiFrame),mainUiFrame.addEventListener("load",d)},MOLPay.prototype.transactionRequest=function(a,b){isInternalDebugging&&console.log("MOLPay transactionRequest paymentdetails = "+JSON.stringify(a,null,""));try{molpayPaymentDetails=JSON.parse(a)}catch(c){molpayPaymentDetails=a}molpayPaymentDetails.module_id=moduleId,molpayPaymentDetails.wrapper_version=wrapperVersion,transactionResultCallback=b,molpayTransactionRequestFrame=document.createElement("iframe");var d=function(a){molpayTransactionRequestFrame.contentWindow.updateSdkData(molpayPaymentDetails,inAppCallback),molpayTransactionRequestFrame.removeEventListener("load",d)};molpayTransactionRequestFrame.id="molpayTransactionRequestFrame",molpayTransactionRequestFrame.allowScriptAccess="always",molpayTransactionRequestFrame.setAttribute("src",molpaySdkUrl),hideFrame(molpayTransactionRequestFrame),document.body.appendChild(molpayTransactionRequestFrame),molpayTransactionRequestFrame.addEventListener("load",d)},MOLPay.prototype.closeMolpay=function(){isClosingMolpay=!0,mainUiFrame.contentWindow.transactionRequest()};var molpay=new MOLPay;module.exports=molpay;